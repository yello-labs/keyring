plugins {
    id 'java'
}

group 'org.yellolab'
version '1.0-SNAPSHOT'

repositories {
    mavenCentral()
}

sourceSets.main.resources {
    srcDir "src/main/resources"
    srcDir "keyring-jni/target/release"
    include "libkeyring_jni**"
}

dependencies {
    testCompile group: 'junit', name: 'junit', version: '4.12'
}

task cargoBuild(type: Exec) {

    workingDir './keyring-jni/'
    if (System.getProperty('os.name').toLowerCase(Locale.ROOT).contains('windows')) {
        commandLine 'cmd', '/c', 'cargo', 'build', '--release'
    } else {
        commandLine 'cargo', 'build', '--release'
    }
}

jar {
    from('keyring-jni/target/release/') {
        include 'libkeyring_jni*'
    }
}

compileJava {
    dependsOn(cargoBuild)
}